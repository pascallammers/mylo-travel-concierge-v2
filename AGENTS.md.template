# Project Name

Brief overview of what this project does and its main purpose.

## Build & Commands

Core commands for development workflow:

```bash
# Install dependencies
npm install  # or: pnpm install, yarn install, pip install -e .

# Start development server
npm run dev  # or: pnpm dev, yarn dev, python manage.py runserver

# Run tests
npm test  # or: pnpm test, pytest, cargo test

# Run single test file
npm test path/to/test.ts  # or: pytest tests/test_file.py

# Type checking
npm run typecheck  # or: pnpm check, mypy .

# Linting & formatting
npm run lint  # or: eslint ., ruff check .
npm run format  # or: prettier --write ., black .

# Build for production
npm run build  # or: pnpm build, cargo build --release
```

## Project Layout

```
├── src/           → Source code
├── tests/         → Test files
├── docs/          → Documentation
├── config/        → Configuration files
└── scripts/       → Build/deployment scripts
```

**File Organization Rules:**
- All source code in `src/`
- Tests colocated or in `tests/`
- Keep configurations in `config/`
- Document architectural decisions in `docs/`

## Development Patterns

### Code Style

- **Language**: TypeScript strict mode / Python 3.11+ / Rust 2021
- **Formatting**: Prettier / Black / rustfmt
- **Line length**: 100 characters max
- **Quotes**: Single quotes for code, double for user-facing strings
- **Imports**: Group and sort (builtin → external → internal)

### Testing Approach

- **Write tests FIRST for bug fixes** - Test-Driven Development
- **Unit tests** for business logic and utilities
- **Integration tests** for API endpoints and database operations
- **E2E tests** for critical user flows
- **Coverage target**: 80% minimum for new code

### Architecture Principles

- **Separation of concerns** - Keep layers isolated
- **DRY (Don't Repeat Yourself)** - Extract common patterns
- **SOLID principles** for object-oriented code
- **Functional patterns** where appropriate
- **Avoid premature optimization** - Profile first

### Never Do This

- ❌ Never commit secrets or API keys (use environment variables)
- ❌ Never force-push to `main` or protected branches
- ❌ Never skip running tests before committing
- ❌ Never use `@ts-ignore` / `# type: ignore` without explanation
- ❌ Never introduce new dependencies without team discussion
- ❌ Never commit commented-out code (use git history instead)
- ❌ Never merge PRs without at least one approval

## Git Workflow

### Branch Naming

```bash
feature/user-authentication
bugfix/login-redirect-loop
hotfix/critical-security-patch
refactor/extract-api-client
docs/update-api-documentation
```

### Commit Messages

Follow conventional commits:

```
feat: add user authentication with JWT
fix: resolve login redirect loop
docs: update API documentation
refactor: extract API client to separate module
test: add integration tests for auth flow
chore: update dependencies
```

### Pull Request Process

1. **Create branch** from `main` with descriptive name
2. **Make changes** and commit frequently
3. **Run tests** locally: `npm test && npm run lint`
4. **Push branch** using `git push --force-with-lease` (feature branches only)
5. **Create PR** with clear title and description:
   - Title format: `[Component] Brief description`
   - Include: What changed, why, testing performed
   - Add screenshots for UI changes
   - Link related issues
6. **Address review feedback** promptly
7. **Squash merge** after approval

### Force-Push Rules

- ✅ `--force-with-lease` allowed on feature branches
- ❌ Never force-push to `main`, `develop`, or release branches
- ⚠️ Coordinate with team if others are working on same branch

## Security Best Practices

### Input Validation

- **Always validate** user input on both client and server
- **Sanitize** all data before storing or displaying
- **Use parameterized queries** for database operations
- **Validate file uploads** (type, size, content)

### Authentication & Authorization

- **Never store passwords** in plain text (use bcrypt/Argon2)
- **Use secure session management** with httpOnly cookies
- **Implement rate limiting** on login/API endpoints
- **Validate tokens** on every protected route
- **Use HTTPS** in production

### Data Protection

- **Environment variables** for all secrets (use .env, never commit)
- **Encrypt sensitive data** at rest and in transit
- **No logging** of passwords, tokens, or PII
- **Implement CSP** (Content Security Policy) headers
- **Regular security audits** with `npm audit` or equivalent

## Performance Guidelines

### Frontend

- **Bundle size**: Keep under 500KB (gzipped)
- **Images**: Optimize before committing (use WebP/AVIF)
- **Lazy loading**: For routes and heavy components
- **Code splitting**: Per route or feature

### Backend

- **API response time**: Target under 200ms
- **Database queries**: Use indexes, avoid N+1
- **Caching**: Implement where appropriate
- **Background jobs**: For long-running operations

### Monitoring

- **Error tracking**: Sentry or equivalent
- **Performance monitoring**: Core Web Vitals for frontend
- **Logging**: Structured logging for production

## Environment Setup

### Required Tools

```bash
# Node.js (or Python, Rust, etc.)
node --version  # v18+ required

# Package manager
pnpm --version  # v8+ recommended

# Database
postgresql --version  # v14+ required

# Optional tools
docker --version  # for containerized development
```

### Environment Variables

Copy `.env.example` to `.env` and configure:

```bash
# Application
NODE_ENV=development
PORT=3000

# Database
DATABASE_URL=postgresql://user:pass@localhost:5432/dbname

# Authentication
JWT_SECRET=your-secret-key-here
SESSION_SECRET=another-secret-here

# External APIs
API_KEY=your-api-key
```

## Common Tasks

### Reset Database

```bash
npm run db:reset
# or: python manage.py migrate --run-syncdb
# or: diesel migration redo
```

### Generate Migration

```bash
npm run db:migration create_users_table
# or: python manage.py makemigrations
# or: diesel migration generate create_users
```

### Run in Watch Mode

```bash
npm run dev:watch
# or: cargo watch -x run
# or: nodemon src/index.ts
```

### Debug Configuration

```json
// .vscode/launch.json
{
  "type": "node",
  "request": "launch",
  "name": "Debug Server",
  "program": "${workspaceFolder}/src/index.ts",
  "preLaunchTask": "npm: build"
}
```

## Team Conventions

### Code Review Checklist

- [ ] Tests added/updated and passing
- [ ] No console.log or debug code
- [ ] Error handling implemented
- [ ] Documentation updated
- [ ] No new linter warnings
- [ ] Performance impact considered
- [ ] Security implications reviewed
- [ ] Accessibility verified (for UI changes)

### Communication

- **Slack**: #dev-team for development discussion
- **PRs**: Use GitHub comments for code-specific discussion
- **Planning**: Weekly sync meetings
- **Blockers**: Raise immediately in Slack
- **Documentation**: Update as you build, not after

## Troubleshooting

### Common Issues

**Port already in use**
```bash
lsof -ti:3000 | xargs kill -9
```

**Dependency conflicts**
```bash
rm -rf node_modules package-lock.json
npm install
```

**Database connection fails**
```bash
# Check if PostgreSQL is running
pg_isready
# Restart if needed
brew services restart postgresql@14
```

**Tests failing locally**
```bash
# Clear test cache
npm test -- --clearCache
# or: pytest --cache-clear
```

## Additional Resources

- [API Documentation](./docs/api.md)
- [Architecture Decision Records](./docs/architecture/)
- [Deployment Guide](./docs/deployment.md)
- [Contributing Guidelines](./CONTRIBUTING.md)

---

**Remember**: This AGENTS.md file helps AI assistants like Factory Droid understand your project. Keep it updated as conventions evolve!
